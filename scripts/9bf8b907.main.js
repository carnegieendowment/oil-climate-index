var utils;!function(){"use strict";utils={getGlobalExtent:function(a,b,c,d){"ghgTotal"===c&&(c=null);var e=d?d:"global",f=c?c:"total";if(Oci.data.globalExtents[a]&&Oci.data.globalExtents[a][e]&&Oci.data.globalExtents[a][e][f]&&Oci.data.globalExtents[a][e][f][b])return Oci.data.globalExtents[a][e][f][b];var g=Oci.data,h=g.info;d&&(h=_.object([d],_.filter(h,function(a,b){return b===d})));var i="min"===b?-1:1,j=null,k={};for(var l in h){for(var m=null,n=+h[l]["Transport Emissions"],o=0;o<g.metadata.water.split(",").length;o++)for(var p=0;p<g.metadata.steam.split(",").length;p++)for(var q=0;q<g.metadata.flare.split(",").length;q++){var r=g.opgee["run"+o+p+q][l],s=+r["Net lifecycle emissions"];(!m||s*i>m*i)&&(m=s)}for(var t=0;t<g.metadata.refinery.split(",").length;t++)[!0,!1].forEach(function(b){var d,e=g.prelim["run"+t][l],f=+utils.getRefiningTotal(e),h=+utils.getCombustionTotal(e,b);k.upstream=m,k.midstream=f,k.downstream=h+n,d=c?k[c]:_.reduce(k,function(a,b){return a+b},0),d=utils.getValueForRatio(d,a,e,b,g.info[l]),(!m||s*i>m*i)&&(m=s),(!j||d*i>j*i)&&(j=d)})}return"perDollar"!==a&&(Oci.data.globalExtents[a]||(Oci.data.globalExtents[a]={}),Oci.data.globalExtents[a][e]||(Oci.data.globalExtents[a][e]={}),Oci.data.globalExtents[a][e][f]||(Oci.data.globalExtents[a][e][f]={}),Oci.data.globalExtents[a][e][f][b]=j),j},generateSocialLinks:function(a){var b="Explore the true cost of technological advancements across the complete oil supply chain.",c="The Oil-Climate Index",d="https://twitter.com/share?text="+b+"&url="+a,e="http://www.linkedin.com/shareArticle?mini=true&summary="+b+"&title="+c+"&url="+a,f="mailto:?subject="+c+"&body="+b+"\n\n"+a;return{twitter:d,linkedIn:e,mail:f}},prettyOilName:function(a){return a.Unique},cloneObject:function(a){if(null===a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)b[c]=this.cloneObject(a[c]);return b},getValueForRatio:function(a,b,c,d,e){switch(b){case"perBarrel":return a;case"perMJ":return a*(1/c.MJperbbl);case"perDollar":return a*(1/this.getPricePerBarrel(c,d,e));default:return a}},getPricePerBarrel:function(a,b,c){var d=a["Portion Gasoline"]*Oci.prices.gasoline.price+a["Portion Jet Fuel"]*Oci.prices.jetFuel.price+a["Portion Diesel"]*Oci.prices.diesel.price+a["Portion Fuel Oil"]*Oci.prices.fuelOil.price+a["Portion Bunker Fuel"]*Oci.prices.bunkerFuel.price;return d=42*d/1e5,b&&(d+=a["Portion Petroleum Coke"]/5*Oci.prices.coke.price/1e5,d+=c["Portion Net Upstream Petcoke"]*Oci.prices.coke.price),d},categoryColorForType:function(a){var b=["#003A63","#009444","#231F20","#006838","#645A4F","#006AA7","#CCC7C2","#8DC63F","#0095DA"],c=d3.scale.ordinal().domain(d3.range(9)).range(b);switch(a){case"Ultra-Deep":return c(0);case"Conventional":return c(1);case"Extra-Heavy":return c(2);case"Heavy":return c(3);case"High Flare":return c(4);case"High Steam":return c(5);case"High Gas":return c(6);case"Light":return c(7);case"Depleted/Watery Oil":return c(8);default:return console.warn("Invalid oil type for color",a),"#ccc"}},buildShareURLFromParameters:function(a){if(!a||""===a)return"";var b=[];for(var c in a)b.push(c+"="+a[c]);var d;d=0===b.length?"":"?"+b.join("&");var e=window.location.hash.split("?")[0],f=window.location.pathname,g=window.location.origin+f+e+d;return g},parseParametersFromShareURL:function(a){if(!a||""===a)return{};var b=a.split("?");if(2!==b.length)return{};for(var c=b[1].split("&"),d={},e=0;e<c.length;e++){var f=c[e].split("=");if(2!==f.length)return{};d[f[0]]=f[1]}return d},makeId:function(a){return a.toLowerCase().replace(/ /g,"-")},capitalize:function(a){return a?a[0].toUpperCase()+a.slice(1):""},numberWithCommas:function(a,b){return"perMJ"===b?a.toFixed(2):(a=a.toFixed(a>1?0:1),a.replace(/\B(?=(\d{3})+(?!\d))/g,","))},setInputFieldOption:function(a,b){for(var c=document.getElementsByName(a),d=0;d<c.length;d++)if(c[d].value===b){c[d].checked=!0;break}},getDatasetKey:function(a){switch(a){case"apiGravity":return"API";case"oilDepth":return"Field Depth";case"waterToOilRatio":return"Water-to-Oil-Ratio";case"gasToOilRatio":return"Gas-to-Oil-Ratio";case"ghgTotal":return"Total Emissions";case"transport":return"Transport Emissions";case"productionVolume":return"Oil Production Volume";case"sulfurContent":return"Sulfur %wt";case"prodBunker":return"Portion Bunker Fuel";case"prodGasoline":return"Portion Gasoline";case"prodDiesel":return"Portion Diesel";case"yearsProduction":return"Field Age";default:return console.warn("Unknown key")}},getUnits:function(a,b){var c=function(a){switch(a){case"perBarrel":return"kg CO₂ eq./barrel crude";case"perMJ":return"kg CO₂ eq./MJ products";case"perDollar":return"kg CO₂ eq./$ products";default:return console.warn("unknown sort ratio"),""}};switch(a){case"apiGravity":return"deg API";case"oilDepth":return"feet";case"waterToOilRatio":return"bbl water/bbl crude";case"gasToOilRatio":return"scf/bbl crude";case"productionVolume":return"barrels per day";case"emissionRate":return"kg CO<sub>2</sub> eq./day";case"yearsProduction":return"Years";case"sulfurContent":return"% weight";case"prodGasoline":case"prodDiesel":case"prodBunker":return"bbl product/100,000 bbl crude";case"type":case"ghgTotal":case"upstream":case"midstream":case"downstream":return c(b)}},getDatasetName:function(a,b,c){var d=function(a,b){if(!b)return a;switch(b){case"perBarrel":return a+="";case"perMJ":return a+=" Per Megajoule";case"perDollar":return a+=" Per Dollar";default:return console.warn("Unknown sort ratio"),a}};switch(a){case"apiGravity":return"API Gravity";case"oilDepth":return"Field Depth";case"waterToOilRatio":return"Water-to-Oil Ratio";case"gasToOilRatio":return"Gas-to-Oil Ratio";case"productionVolume":return"Current Estimated Oil Production";case"prodGasoline":return"Gasoline Production";case"prodDiesel":return"Diesel Production";case"prodBunker":return"Bunker Fuel Production";case"yearsProduction":return"Years in Production";case"sulfurContent":return"Sulfur Content";case"type":case"ghgTotal":case"midstream":case"upstream":case"downstream":return c===!0&&"ghgTotal"!==a?d(a+" Greenhouse Gas Emissions",b):d("Total Greenhouse Gas Emissions",b);default:return console.warn("Unknown key"),""}},indexInArray:function(a,b){for(var c=-1,d=0;d<a.length;d++)if(a[d]==b){c=d;break}return c},getOPGEEModel:function(a,b,c){var d=Oci.data.metadata,e=this.indexInArray(this.trimMetadataArray(d.water.split(",")),a),f=this.indexInArray(this.trimMetadataArray(d.steam.split(",")),b),g=this.indexInArray(this.trimMetadataArray(d.flare.split(",")),c),h="run";return h+=-1===e||-1===f||-1===g?"000":[e,f,g].join("")},getPRELIMModel:function(a){var b=Oci.data.metadata,c=this.trimMetadataArray(b.refinery.split(",")).indexOf(a),d="run";return d+=-1===c?"0":c},getCombustionTotal:function(a,b){var c=[a.Gasoline,a["Jet Fuel"],a.Diesel,a["Fuel Oil"],a["Bunker Fuel"],a["Light Ends (RFG)"]];return b&&(c.push(a["Petroleum Coke"]),c.push(a["Net Upstream Petcoke"])),d3.sum(c)},getDownstreamComponents:function(a,b,c){var d=["Heat","Steam","Electricity","Hydrogen","Fluid","Excess","Portion","Total","Unique","MJperbbl"],e=_.filter(_.map(a,function(a,b){return{name:b,value:a}}),function(a){return!_.contains(["Petroleum Coke","Net Upstream Petcoke"],a.name)});b===!0&&e.push({name:"Petroleum Coke",value:(Number(a["Petroleum Coke"])||0)+(Number(a["Net Upstream Petcoke"])||0)}),e.push({name:"Transport to Consumers",value:c});var f=_.filter(e,function(a){return!_.contains(d,a.name.split(" ")[0])&&Number(a.value)>.005});return this.preorderedSort(f,"downstream")},getRefiningComponents:function(a){var b=[{name:"Heat",value:this.aggregatePrelim(a,"Heat")},{name:"Electricity",value:+a.Electricity},{name:"Steam",value:this.aggregatePrelim(a,"Steam")},{name:"Hydrogen (via Steam Methane Reformer)",value:this.aggregatePrelim(a,"Hydrogen")},{name:"Catalyst Regeneration (Fluid Catalytic Cracking)",value:+a["Fluid Catalytic Cracking Regeneration"]}];return _.filter(b,function(a){return a.value>.005})},getExtractionComponents:function(a){var b=["Water-to-Oil-Ratio","Net","API","Gas-to-Oil-Ratio","Unique"],c=_.map(a,function(a,b){return{name:b,value:a}}),d=_.filter(c,function(a){return!_.contains(b,a.name.split(" ")[0])&&"0"!==Number(a.value).toFixed(0)});return this.preorderedSort(d,"upstream")},aggregatePrelim:function(a,b){return _.reduce(a,function(a,c,d){return a+(d.split(" ")[0]===b?Number(c):0)},0)},getRefiningTotal:function(a){return a["Total refinery processes "]},trimMetadataArray:function(a){return a.map(function(a){return a.trim()})},createTooltipHtml:function(a,b,c,d,e){for(var f="",g=0;g<c.length;g++){var h=c[g];f+="<dt>"+h.name+'<small class="units">'+h.units+"</small></dt>",f+="<dd>"+h.value+"</dd>"}var i='<div class="popover top in"><div class="popover-inner"><div class="popover-header"><p class="popover-meta oil-type"><a href="methodology.html#oiltype-legend"><span class="swatch"></span>'+b+'</a></p><h3 class="popover-title">'+a+"</h3>"+(e?'<p class="description">'+e+"</p>":"")+'</div><div class="popover-body"><dl class="stats-list">'+f+'</dl></div><div class="popover-footer"><p><a href="#oil/'+d+'" title="View oil profile" class="view-more">View details</a></p></div></div></div>';return i},insideTooltip:function(a,b){var c=$(".d3-tip")[0].getBoundingClientRect();return a>c.left-30&&a<c.right&&b<c.bottom+30&&b>c.top},initDropdown:function(){$('[data-toggle="dropdown"]:not(.dropdown-processed)').click(function(a){a.preventDefault(),a.stopPropagation(),$(this).addClass("dropdown-processed");var b=$(this).parent(".dropdown");b.toggleClass("open"),Oci.view.shareOpen(),$(".dropdown.open").not(b).removeClass("open")})},preorderedSort:function(a,b){return _.sortBy(a,function(a){return Oci.order[b].indexOf(a.name)})},refineryNameToDropdown:function(a){var b;switch(a){case"Hydroskimming Configuration":b=1;break;case"Medium Conversion: FCC & GO-HC ":b=2;break;case"Deep Conversion: FCC & GO-HC":b=3}return b}}}(),window.Oci={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";Oci.getData(),Oci.getPrices(),Oci.getBlurbs(),Oci.router=new Oci.Routers.Router,Backbone.history.start()},getData:function(){"use strict";$.ajax({type:"GET",url:"./data/oils.json",dataType:"json",success:function(a){Oci.data=a,Oci.data.globalExtents={}},async:!1})},getBlurbs:function(){"use strict";$.ajax({type:"GET",url:"./data/blurbs.json",dataType:"json",success:function(a){Oci.blurbs=a},async:!1})},getPrices:function(){"use strict";$.ajax({type:"GET",url:"./data/prices.json",dataType:"json",success:function(a){Oci.prices=a,Oci.origPrices=utils.cloneObject(a)},async:!1})},showPricesModal:function(a){"use strict";a?$("#modal-prices").addClass("revealed"):$("#modal-prices").removeClass("revealed")},prices:{},data:{},order:{upstream:["Exploration","Drilling","Production","Processing","Upgrading","Maintenance","Waste","Venting, Flaring, and Fugitive Emissions","Diluent","Miscellaneous","Transport to Refinery","Offsite emissions"],downstream:["Transport to Consumers","Gasoline","Jet Fuel","Diesel","Fuel Oil","Petroleum Coke","Bunker Fuel","Light Ends (RFG)"]}},$(document).ready(function(){"use strict";Oci.init(),$("[data-dropdown-nav]").click(function(a){a.preventDefault(),a.stopPropagation(),$(this).parents("nav.page-nav").toggleClass("open")}),$(document).click(function(){$("nav.page-nav").removeClass("open")})}),this.JST=this.JST||{},this.JST["app/scripts/templates/compareoils.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<section id="compare-oils-view" class="view">\n\n  <!-- intro -->\n  <div class="intro">\n    <div class="prose">\n      <h1 class="prose-prime-title">Compare and sort oils by their estimated greenhouse gas emissions from each part of the supply chain.</h1>\n      <p>The global oil market is made up of complex resources, thousands of extraction sites, evolving production methods, different refinery configurations, vast distribution and logistics networks, and varying end uses of the numerous petroleum products. All of these factors contribute to an oil’s climate impact.</p>\n      <p>Use the sorting tools on the right to compare the GHG impact of specific parts of the oil supply chain. Edit certain model parameters to estimate how upstream, midstream, and downstream decisions change GHG emissions.</p>\n    </div>\n    <div class="actions">\n      <ul class="actions-list">\n        <li class="dropdown">\n          <a href="#" title="Share" class="bttn bttn-m bttn-base-light share" data-toggle="dropdown">Share</a>\n          <div class="dropdown-content right">\n            <ul class="dropdown-menu" role="menu">\n              <li class="sep has-icon-before twitter"><a href="" target="_blank" title="Share on Twitter">Twitter</a></li>\n              <li class="sep has-icon-before facebook"><a href="http://facebook.com/sharer.php" target="_blank" title="Share on Facebook">Facebook</a></li>\n              <li class="sep has-icon-before linkedin"><a href="" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>\n              <li class="sep has-icon-before email"><a href="" title="Share by email">Email</a></li>\n            </ul>\n            <div class="input-group dropdown-footer">\n              <input class="form-control input-s" type="text" id="share-copy" value="" readonly />\n              <a href="#" title="Copy to clipboard" class="bttn bttn-s bttn-base-light copy hide-txt" id="compare-oils-share" data-title="Copy to clipboard"><span>Copy to clipboard</span></a>\n            </div>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  <!--/ intro -->\n\n  <!-- chart-section -->\n  <div class="row">\n    <section class="panel has-aside" id="co-chart-cont">\n      <header class="panel-header">\n        <div class="panel-headline">\n          <h1 class="panel-title">Chart</h1>\n        </div>\n      </header>\n      <div class="panel-body">\n        <div class="chart-legend">\n          <dl class="key">\n            <dt class="key-title">Key</dt>\n            <dd class="key-item upstream">Upstream</dd>\n            <dd class="key-item midstream">Midstream</dd>\n            <dd class="key-item downstream">Downstream</dd>\n          </dl>\n        </div>\n        <div id="compare-oils" class="data-charts"></div>\n      </div>\n      <div class="panel-aside">\n        <div class="data-controls">\n\n          <!-- model-parameters -->\n          <div id="model-parameters" class="control-section"></div>\n          <!--/ model-parameters -->\n\n          <form>\n            <div class="control-section">\n              <fieldset id="ratio-select">\n                <legend class="control-title">Sort by Emissions Units</legend>\n                <div class="radio">\n                  <label><input type="radio" name="ratio-select" value="perBarrel" checked> GHGs/Barrel</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="ratio-select" value="perMJ"> GHGs/Megajoule</label>\n                </div>\n                <div class="radio has-button">\n                  <label><input type="radio" name="ratio-select" value="perDollar"> GHGs/$</label>\n                  <a href="#" id="price-button" title="Adjust values" class="bttn bttn-base-light bttn-xs edit">Values</a>\n                </div>\n              </fieldset>\n            </div>\n\n            <div class="control-section">\n              <fieldset id="step-select">\n                <legend class="control-title">Sort by Emissions Components</legend>\n                <div class="radio">\n                  <label><input type="radio" name="step-select" value="ghgTotal" checked> Total GHGs</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="step-select" value="upstream"> Upstream</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="step-select" value="midstream"> Midstream</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="step-select" value="downstream"> Downstream</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="step-select" value="type"> Oil Type</label>\n                </div>\n              </fieldset>\n            </div>\n\n            <div class="control-section">\n              <fieldset id="sort-select">\n                <legend class="control-title">Sort by Emissions Order</legend>\n                <div class="radio">\n                  <label><input type="radio" name="sort-select" value="true" checked> High-to-Low</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="sort-select" value="false"> Low-to-High</label>\n                </div>\n              </fieldset>\n            </div>\n          </form>\n\n        </div>\n      </div>\n    </section>\n  </div>\n  <!--/ chart-section -->\n\n</section>\n';return __p},this.JST["app/scripts/templates/emissionsdrivers.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<section id="emissions-drivers-view" class="view">\n\n  <!-- intro -->\n  <div class="intro">\n    <div class="prose">\n      <h1 class="prose-prime-title">See the relationships that an oil’s unique physical properties have on the climate.</h1>\n      <p>An oil’s characteristics have different effects on its GHG emissions. Some factors, like an oil’s sulfur content, appear to have little impact on its midstream refining emissions. Meanwhile other factors, like an oil’s API gravity (or weight), appear to correlate with downstream end-use emissions.</p>\n      <p>Use the sorting tools on the right to plot oils’ estimated GHG emissions according to their various properties.</p>\n    </div>\n    <div class="actions">\n      <ul class="actions-list">\n        <li class="dropdown">\n          <a href="#" title="Share" class="bttn bttn-m bttn-base-light share" data-toggle="dropdown">Share</a>\n          <div class="dropdown-content right">\n            <ul class="dropdown-menu" role="menu">\n              <li class="sep has-icon-before twitter"><a href="" target="_blank" title="Share on Twitter">Twitter</a></li>\n              <li class="sep has-icon-before facebook"><a href="http://facebook.com/sharer.php" target="_blank" title="Share on Facebook">Facebook</a></li>\n              <li class="sep has-icon-before linkedin"><a href="" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>\n              <li class="sep has-icon-before email"><a href="" title="Share by email">Email</a></li>\n            </ul>\n            <div class="input-group dropdown-footer">\n              <input class="form-control input-s" type="text" id="share-copy" value="" readonly />\n              <a href="#" title="Copy to clipboard" class="bttn bttn-s bttn-base-light copy hide-txt" id="emissions-drivers-share" data-title="Copy to clipboard"><span>Copy to clipboard</span></a>\n            </div>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  <!--/ intro -->\n\n  <!-- chart-section -->\n  <div class="row">\n    <section class="panel has-aside" id="ed-chart-cont">\n      <header class="panel-header">\n        <div class="panel-headline">\n          <h1 class="panel-title">Chart</h1>\n        </div>\n      </header>\n      <div class="panel-body">\n        <div id="emissions-drivers" class="data-charts"></div>\n      </div>\n      <div class="panel-aside">\n        <div class="data-controls">\n\n          <!-- model-parameters -->\n          <div id="model-parameters" class="control-section"></div>\n          <!--/ model-parameters -->\n\n          <form>\n            <div class="control-section">\n              <fieldset id="ratio-select">\n                <legend class="control-title">Sort by Units</legend>\n                <div class="radio">\n                  <label><input type="radio" name="ratio-select" value="perBarrel" checked> GHGs/Barrel</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="ratio-select" value="perMJ"> GHGs/Megajoule</label>\n                </div>\n                <div class="radio has-button">\n                  <label><input type="radio" name="ratio-select" value="perDollar"> GHGs/$</label>\n                  <a href="#" id="price-button" title="Adjust values" class="bttn bttn-base-light bttn-xs edit">Values</a>\n                </div>\n              </fieldset>\n            </div>\n\n            <div class="control-section">\n              <fieldset id="x-select">\n                <legend class="control-title">Select Oil Characteristic (X axis)</legend>\n                <div class="radio">\n                  <label><input type="radio" name="x-select" value="apiGravity" checked> API Gravity</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="x-select" value="waterToOilRatio"> Water-to-Oil Ratio</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="x-select" value="gasToOilRatio"> Gas-to-Oil Ratio</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="x-select" value="sulfurContent"> Sulfur Content</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="x-select" value="yearsProduction"> Years in Production</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="x-select" value="prodGasoline"> Gasoline Production</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="x-select" value="prodDiesel"> Diesel Production</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="x-select" value="prodBunker"> Bunker Fuel Production</label>\n                </div>\n              </fieldset>\n            </div>\n\n            <div class="control-section">\n              <fieldset id="y-select">\n                <legend class="control-title">Select Emissions Component (Y axis)</legend>\n                <div class="radio">\n                  <label><input type="radio" name="y-select" value="ghgTotal" checked> Total GHGs</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="y-select" value="upstream"> Upstream</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="y-select" value="midstream"> Midstream</label>\n                </div>\n                <div class="radio">\n                  <label><input type="radio" name="y-select" value="downstream"> Downstream</label>\n                </div>\n              </fieldset>\n            </div>\n          </form>\n\n        </div>\n      </div>\n    </section>\n  </div>\n  <!--/ chart-section -->\n\n</section>\n';return __p},this.JST["app/scripts/templates/modelparameters.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<h3 class="control-title"><a href="#" class="toggle" data-toggle="tooltip" data-placement="bottom" title="Change operating decisions to see how they affect estimated GHG emissions">Model parameters</a></h3>\n<div class="mp-summary">\n  <dl class="mp-list">\n    <dt class="key">Flaring-to-Oil Ratio</dt>\n    <dd class="value flare" data-toggle="tooltip" data-placement="bottom" title="Flaring-to-Oil Ratio: Gas associated with oil can be disposed of by burning"><span></span></dd>\n    <dt class="key">Steam-to-Oil Ratio</dt>\n    <dd class="value steam" data-toggle="tooltip" data-placement="bottom" title="Steam-to-Oil Ratio: Steam can be used to make oil flow during extraction"><span></span></dd>\n    <dt class="key">Water Intensity</dt>\n    <dd class="value water" data-toggle="tooltip" data-placement="bottom" title="Water Intensity: Water can be produced with oil and/or used during extraction"><span></span></dd>\n    <dt class="key">Refinery Configuration</dt>\n    <dd class="value refinery" data-toggle="tooltip" data-placement="bottom" title="Refinery Configuration: Refinery design can alter midstream emissions and downstream products"><span></span></dd>\n    <dt class="key">Petcoke Combustion</dt>\n    <dd class="value petcoke" data-toggle="tooltip" data-placement="bottom" title="Petroleum Coke Combustion: This dirty, bottom-of-the-barrel product might be burned"><span></span></dd>\n  </dl>\n</div>\n<div class="mp-edit">\n  <div class="param-control flare">\n    <strong class="param-title" data-toggle="tooltip" data-placement="bottom" title="Gas associated with oil can be disposed of by burning">Flaring-to-Oil Ratio</strong>\n    <div class="slider" id="slider-flaring"></div>\n  </div>\n  <div class="param-control steam">\n    <strong class="param-title" data-toggle="tooltip" data-placement="bottom" title="Steam can be used to make oil flow during extraction">Steam-to-Oil Ratio</strong>\n    <div class="slider" id="slider-steam"></div>\n  </div>\n  <div class="param-control water">\n    <strong class="param-title" data-toggle="tooltip" data-placement="bottom" title="Water can be produced with oil and/or used during extraction">Water Intensity</strong>\n    <div class="slider" id="slider-water"></div>\n  </div>\n  <div class="param-control refinery">\n    <strong class="param-title" data-toggle="tooltip" data-placement="bottom" title="Refinery design can alter midstream emissions and downstream products">Refinery Configuration</strong>\n    <select class="config-dropdown form-control" id="dropdown-refinery">\n      <option value="0 = Default">Default</option>\n      <option value="1 = Hydroskimming">Hydroskimming</option>\n      <option value="2 = Medium Conversion">Medium Conversion</option>\n      <option value="3 = Deep Conversion (Coking)">Deep Conversion: Coking</option>\n      <option value="4 = Deep Conversion (Hydrotreating)">Deep Conversion: Hydrocracking</option>\n    </select>\n  </div>\n  <div class="param-control petcoke">\n    <strong class="param-title" data-toggle="tooltip" data-placement="bottom" title="This dirty, bottom-of-the-barrel product might be burned">Petroleum Coke Combustion</strong>\n    <label class="switch" for="toggle-petcoke">\n      <input id="toggle-petcoke" type="checkbox" checked />\n      <span class="swtich-text">Petcoke combustion</span>\n      <span class="switch-ui"></span>\n    </label>\n  </div>\n</div>\n';return __p},this.JST["app/scripts/templates/oildetails.ejs"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<section id="oil-details-view" class="view">\n\n  <!-- intro -->\n  <div class="intro">\n    <div class="prose">\n      <p class="prose-meta">Oil details</p>\n      <h1 class="prose-prime-title" id="oil-name"><!-- oil name --></h1>\n      <p id="oil-details-description"><!-- oil description --></p>\n      <p>Hover over each bar for the breakout of upstream, midstream, and downstream emissions. Use the controls on the right to see how operating decisions change an oil’s estimated GHG emissions.</p>\n    </div>\n    <div class="actions">\n      <ul class="actions-list">\n        <li class="dropdown">\n          <a href="#" title="Share" class="bttn bttn-m bttn-base-light share" data-toggle="dropdown">Share</a>\n          <div class="dropdown-content right">\n            <ul class="dropdown-menu" role="menu">\n              <li class="sep has-icon-before twitter"><a href="" target="_blank" title="Share on Twitter">Twitter</a></li>\n              <li class="sep has-icon-before facebook"><a href="http://facebook.com/sharer.php" target="_blank" title="Share on Facebook">Facebook</a></li>\n              <li class="sep has-icon-before linkedin"><a href="" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>\n              <li class="sep has-icon-before email"><a href="" title="Share by email">Email</a></li>\n            </ul>\n            <div class="input-group dropdown-footer">\n              <input class="form-control input-s" type="text" id="share-copy" value="" readonly />\n              <a href="#" title="Copy to clipboard" class="bttn bttn-s bttn-base-light copy hide-txt" id="oil-details-share" data-title="Copy to clipboard"><span>Copy to clipboard</span></a>\n            </div>\n          </div>\n        </li>\n        <li><a href="#" title="Download" class="bttn bttn-m bttn-base-light download">Download</a></li>\n      </ul>\n    </div>\n  </div>\n  <!--/ intro -->\n\n  <!-- chart-section -->\n  <div class="row">\n    <section class="panel has-aside" id="od-chart-cont">\n      <header class="panel-header">\n        <div class="panel-headline">\n          <h1 class="panel-title">Chart</h1>\n        </div>\n      </header>\n      <div class="panel-body">\n        <div class="data-charts">\n          <div class="chart-item">\n            <h3>TOTAL GREENHOUSE GAS EMISSIONS PER BARREL <span class="raw">(DEFAULT)</span></h3>\n            <p class="units">'+(null==(__t=totalUnits)?"":__t)+'</p>\n            <p class="value"><span id="model-total"></span> <sub class="raw" id="default-total"></sub></p>\n          </div>\n          <div class="chart-item">\n            <h3>Upstream Emissions</h3>\n            <div class="bar" id="upstream-bar"></div>\n          </div>\n          <div class="chart-item">\n            <h3>Midstream Emissions</h3>\n            <div class="bar" id="midstream-bar"></div>\n          </div>\n          <div class="chart-item">\n            <h3>Downstream Emissions</h3>\n            <div class="bar" id="downstream-bar"></div>\n          </div>\n        </div>\n      </div>\n\n      <div class="panel-aside">\n        <div class="data-controls">\n\n          <!-- model-parameters -->\n          <div id="model-parameters" class="control-section static"></div>\n          <!--/ model-parameters -->\n\n        </div>\n      </div>\n    </section>\n  </div>\n  <!--/ chart-section -->\n\n  <!-- details -->\n  <div class="row details">\n\n    ',oil.keyStats.length&&(__p+='\n    <section id="key-stats-cont" class="panel panel-m">\n      <header class="panel-header">\n        <div class="panel-headline">\n          <h1 class="panel-title">Key Stats</h1>\n        </div>\n      </header>\n      <div class="panel-body">\n        <dl class="stats-list">\n          ',_.each(oil.keyStats,function(a){__p+="\n          <dt>"+(null==(__t=a.key)?"":__t)+'</dt>\n          <dd>\n            <span class="stat-title" data-toggle="tooltip" title=\''+(null==(__t=a.title)?"":__t)+"'>"+(null==(__t=a.value)?"":__t)+"</span>\n          </dd>\n          "}),__p+="\n        </dl>\n      </div>\n    </section>\n    "),__p+='\n\n    <section id="map-locations-cont" class="panel panel-m">\n      <header class="panel-header">\n        <div class="panel-headline">\n          <h1 class="panel-title">Map locations</h1>\n        </div>\n      </header>\n      <div class="panel-body">\n        <div id="map"></div>\n      </div>\n    </section>\n  </div>\n  <!--/ details -->\n\n</section>\n';return __p},this.JST["app/scripts/templates/prices.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="modal-inner">\n  <header class="modal-header">\n    <h1 class="modal-title">Adjust values</h1>\n    <a href="#" title="Close" class="modal-close" data-modal-dismiss><span>Close</span></a>\n    <p>Estimate the impact of market price fluctuations on an oil’s emissions per dollar of petroleum product. Enter values for petroleum product prices below and click Apply to change. Click Reset for default values.</p>\n  </header>\n  <div class="modal-body">\n    <form class="form-horizontal">\n      <div class="form-group">\n        <label for="gasoline">Gasoline</label>\n        <div class="input-group">\n          <div class="input-group-addon">$/gallon</div>\n          <input class="form-control price-input" type="text" name="gasoline" id="gasoline" placeholder="Price" />\n        </div>\n      </div>\n      <div class="form-group">\n        <label for="diesel">Diesel</label>\n        <div class="input-group">\n          <div class="input-group-addon">$/gallon</div>\n          <input class="form-control price-input" type="text" name="diesel" id="diesel" placeholder="Price" />\n        </div>\n      </div>\n      <div class="form-group">\n        <label for="jetFuel">Jet Fuel</label>\n        <div class="input-group">\n          <div class="input-group-addon">$/gallon</div>\n          <input class="form-control price-input" type="text" name="jetFuel" id="jetFuel" placeholder="Price" />\n        </div>\n      </div>\n      <div class="form-group">\n        <label for="bunkerFuel">Bunker Fuel</label>\n        <div class="input-group">\n          <div class="input-group-addon">$/gallon</div>\n          <input class="form-control price-input" type="text" name="bunkerFuel" id="bunkerFuel" placeholder="Price" />\n        </div>\n      </div>\n      <div class="form-group">\n        <label for="fuelOil">Fuel Oil</label>\n        <div class="input-group">\n          <div class="input-group-addon">$/gallon</div>\n          <input class="form-control price-input" type="text" name="fuelOil" id="fuelOil" placeholder="Price" />\n        </div>\n      </div>\n      <div class="form-group">\n        <label for="coke">Coke</label>\n        <div class="input-group">\n          <div class="input-group-addon">$/ton</div>\n          <input class="form-control price-input" type="text" name="coke" id="coke" placeholder="Price" />\n        </div>\n      </div>\n    </form>\n    <div class="footnote">\n      <p>All prices are based on 2015 values except for coke, which is based on 2014 values.</p>\n    </div>\n  </div>\n  <footer class="modal-footer">\n    <button type="button" title="Cancel" class="bttn bttn-m bttn-base-light cancel" data-modal-dismiss>Cancel</button>\n    <button type="button" title="Reset" class="bttn bttn-m bttn-base-light reset">Reset</button>\n    <button type="button" title="Apply" class="bttn bttn-m bttn-base apply" id="apply-prices">Apply</button>\n  </footer>\n</div>\n';
return __p},this.JST["app/scripts/templates/supplycurve.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<section id="supply-curve-view" class="view">\n\n  <!-- intro -->\n  <div class="intro">\n    <div class="prose">\n      <h1 class="prose-prime-title">Explore climate impacts across the expanding oil spectrum.</h1>\n      <p>Oils have varying impacts on the climate. Differentiating between these effects involves estimating total greenhouse gas (GHG) emissions for each oil throughout the oil supply chain—from upstream extraction to midstream refining to downstream end use. And that is what the <a href="http://carnegieendowment.org/2015/03/11/know-your-oil-creating-global-oil-climate-index" target="_blank">Oil-Climate Index (OCI)</a> does.</p>\n      <p>This emissions supply curve presents the oils modeled to date in the OCI. The oils are ranked by total estimated GHG emissions per barrel.</p>\n      <p>Hover over any bar to see the oil name and its assigned oil-climate category (color code). Click “view details” to see additional information about that oil.</p>\n    </div>\n    <div class="actions">\n      <ul class="actions-list">\n        <li class="dropdown">\n          <a href="#" title="Share" class="bttn bttn-m bttn-base-light share" data-toggle="dropdown">Share</a>\n          <div class="dropdown-content right">\n            <ul class="dropdown-menu" role="menu">\n              <li class="sep has-icon-before twitter"><a href="" target="_blank" title="Share on Twitter">Twitter</a></li>\n              <li class="sep has-icon-before facebook"><a href="http://facebook.com/sharer.php" target="_blank" title="Share on Facebook">Facebook</a></li>\n              <li class="sep has-icon-before linkedin"><a href="" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>\n              <li class="sep has-icon-before email"><a href="" title="Share by email">Email</a></li>\n            </ul>\n            <div class="input-group dropdown-footer">\n              <input class="form-control input-s" type="text" id="share-copy" value="" readonly />\n              <a href="#" title="Copy to clipboard" class="bttn bttn-s bttn-base-light copy hide-txt" id="supply-curve-share" data-title="Copy to clipboard"><span>Copy to clipboard</span></a>\n            </div>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  <!--/ intro -->\n\n  <!-- chart-section -->\n  <div class="row">\n    <section class="panel" id="sc-chart-cont">\n      <header class="panel-header">\n        <div class="panel-headline">\n          <h1 class="panel-title">Chart</h1>\n        </div>\n      </header>\n      <div class="panel-body">\n        <div id="supply-curve" class="data-charts"></div>\n      </div>\n    </section>\n  </div>\n  <!--/ chart-section -->\n\n</section>\n';return __p},Oci.Routers=Oci.Routers||{},function(){"use strict";var a=5e3;Oci.Routers.Router=Backbone.Router.extend({initialize:function(){new Oci.Views.Prices},routes:{"":"supplyCurve",compare:"compareOils",drivers:"emissionsDrivers","oil/:id":"oilDetails",demo:"playDemo"},playDemo:function(){var b=this,c=0,d=function(){switch(c){case 0:b.execute(b.supplyCurve,[null]);break;case 1:b.execute(b.compareOils,[null]);break;case 2:b.execute(b.emissionsDrivers,[null]);break;case 3:b.execute(b.oilDetails,["us-alaskan-north-slope",null])}setTimeout(function(){c=(c+1)%4,d()},a)};d()},execute:function(a,b){this.allRoutes(),a&&a.apply(this,b)},supplyCurve:function(){Oci.view=new Oci.Views.SupplyCurve,$("#menu-supply").addClass("active")},compareOils:function(){Oci.view=new Oci.Views.CompareOils,$("#menu-compare").addClass("active")},emissionsDrivers:function(){Oci.view=new Oci.Views.EmissionsDrivers,$("#menu-emissions").addClass("active")},oilDetails:function(a){Oci.view=new Oci.Views.OilDetails({oil:a}),$(window).scrollTop(0)},allRoutes:function(){Oci.view&&($("body").unbind(),$(window).off("resize"),Oci.view.undelegateEvents(),$(".d3-tip").remove(),$("#menu-block li").removeClass("active"),$("#menu-supply").removeClass("active")),ga("send","pageview",window.location.hash)}})}(),Oci.Views=Oci.Views||{},function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n="#supply-curve",o={top:38,right:8,bottom:72,left:84},p=2.5,q=2e4;Oci.Views.SupplyCurve=Backbone.View.extend({template:JST["app/scripts/templates/supplycurve.ejs"],el:".content",events:{"click #left-button":"goLeft","click #right-button":"goRight","click .share":"handleShare"},initialize:function(){a=this,$(window).on("resize",a.handleResize),$("body").keyup(a.handleKeyUp),this.tip=d3.tip().attr("class","d3-tip").html(function(a){var b=utils.numberWithCommas(a.ghgTotal),c=utils.numberWithCommas(a.productionVolume),d=utils.numberWithCommas(a.ghgTotal*a.productionVolume),e=[{name:"GHG Emissions",value:b,units:utils.getUnits("ghgTotal","perBarrel")},{name:"Current Production",value:c,units:utils.getUnits("productionVolume")},{name:"Estimated GHG Emission Rate",value:d,units:utils.getUnits("emissionRate")}],f="";return utils.createTooltipHtml(a.name,a.type,e,a.id,f)}).offset([-10,0]),a.render()},render:function(){this.$el.html(this.template()),this.chartInit(),this.linkShareButton(),utils.initDropdown()},linkShareButton:function(){var a=new ZeroClipboard($("#supply-curve-share"));a.on("ready",function(){a.on("copy",function(a){var b=a.clipboardData,c=utils.buildShareURLFromParameters({});b.setData("text/plain",c)}),a.on("aftercopy",function(){alert("The shareable URL has been copied to your clipboard.")})})},setActiveRect:function(){var b=j[k];a.setLabelNameAndUrl(b),d3.selectAll("rect").classed("active",!1);var c="#index-"+k;d3.select(c).classed("active",!0)},formatStackedData:function(){m=0,j.sort(function(a,b){return a.ghgTotal-b.ghgTotal}),j.map(function(a,b,c){a.plotProductionVolume=a.productionVolume<q?q:a.productionVolume,a.x0=0===b?0:c[b-1].x0+c[b-1].plotProductionVolume,m+=c[b].plotProductionVolume})},buildDataset:function(a){for(var b=[],c=Object.keys(a.info),d=0;d<c.length;d++){var e=a.info[c[d]],f={id:utils.makeId(e.Unique),name:utils.prettyOilName(e),productionVolume:+e["Oil Production Volume"],ghgTotal:+e["Total Emissions"],type:e["Overall Crude Emissions Category"].trim(),category:e["Sulfur Category"],productionVolumeCategory:e["Production Volume"],country:e.Country,onshore:e["Onshore/Offshore"]};b.push(f)}return b},chartInit:function(){var n=function(){e=d3.scale.linear().domain([0,m]).range([0,c]),f=d3.scale.linear().domain([0,d3.max(j,function(a){return 1*a.ghgTotal})]).range([d,0])},q=function(){g=d3.svg.axis().scale(e).orient("bottom").ticks(10).tickFormat(function(a){return a/1e6}),h=d3.svg.axis().scale(f).orient("left").ticks(5),i.append("g").attr("class","y axis").attr("transform","translate(0,0)").call(h),i.append("g").attr("class","x axis").attr("transform","translate(0,"+(d+4)+")").call(g);var a=i.append("g");a.append("text").attr("transform","translate("+c/2+","+(d+o.bottom-25)+")").style("text-anchor","middle").attr("class","x axis title").text(utils.getDatasetName("productionVolume")),a.append("text").attr("transform","translate("+c/2+","+(d+o.bottom-5)+")").style("text-anchor","middle").attr("class","x axis title subtitle").text("Million barrels per day"),a=i.append("g"),a.append("text").attr("transform","rotate(-90)").attr("y",-o.left).attr("x",-(d/2)).attr("dy","1em").style("text-anchor","middle").attr("class","y axis title").text(utils.getDatasetName("ghgTotal","perBarrel")),a.append("text").attr("transform","rotate(-90)").attr("y",-o.left+20).attr("x",-(d/2)).attr("dy","1em").style("text-anchor","middle").attr("class","y axis title subtitle").text(utils.getUnits("ghgTotal","perBarrel")),i.append("text").attr("y",-20).attr("x",c/2).style("text-anchor","middle").attr("class","title main-title").text("Total Estimated GHG Emissions and Production Volumes for 30 OCI Test Oils")},r=function(){i.selectAll("rect").data(j).enter().append("rect").attr("x",function(a){return e(a.x0)}).attr("y",function(a){return f(a.ghgTotal)}).attr("width",function(a){return e(a.plotProductionVolume)}).attr("height",function(a){return d-f(a.ghgTotal)}).attr("fill",function(a){return utils.categoryColorForType(a.type)}).attr("opacity",.8).attr("id",function(a,b){return"index-"+b}).on("click",function(b){a.setLabelNameAndUrl(b),d3.selectAll("rect").classed("active",!1),d3.select(this).classed("active",!0);var c=d3.select(this).attr("id");k=c.split("-")[1]}).on("mouseover",function(b){a.tip.show(b),$(".swatch").css("background",utils.categoryColorForType(b.type))}).on("mouseout",function(){utils.insideTooltip(d3.event.clientX,d3.event.clientY)?$(".d3-tip").on("mouseleave",function(){a.tip.hide()}):a.tip.hide()})};b=$("#supply-curve").parent(),c=b.width()-o.left-o.right,d=Math.round(c/p),i=d3.select("#supply-curve").append("svg").attr("width",c+o.left+o.right).attr("height",d+o.top+o.bottom).append("g").attr("transform","translate("+o.left+","+o.top+")"),i.call(a.tip),j=a.buildDataset(Oci.data),l=j,a.formatStackedData(),n(),q(),r(),k=Math.floor(j.length/2),a.setActiveRect(k)},setLabelNameAndUrl:function(a){var b=$("#name-label");b.text(a.name),b.attr("href","#oil/"+a.id)},goLeft:function(){k--,0>k&&(k=j.length-1),a.setActiveRect()},goRight:function(){k++,k>=j.length&&(k=0),a.setActiveRect()},handleKeyUp:function(b){37===b.keyCode?a.goLeft():39===b.keyCode&&a.goRight()},handleResize:function(){c=b.width()-o.left-o.right,d=Math.round(c/p),d3.select(n+" svg").remove(),a.chartInit()},handleShare:function(a){a.preventDefault()},shareOpen:function(){var a=utils.buildShareURLFromParameters({}),b=encodeURIComponent(utils.buildShareURLFromParameters({})),c=utils.generateSocialLinks(b);$("li.twitter a").attr("href",c.twitter),$("li.linkedin a").attr("href",c.linkedIn),$("li.email a").attr("href",c.mail),$("#share-copy").attr("value",a)}})}(),Oci.Views=Oci.Views||{},function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s="#compare-oils",t=1500,u={top:72,right:12,bottom:0,left:8},v=40,w=["upstream","midstream","downstream"];Oci.Views.CompareOils=Backbone.View.extend({template:JST["app/scripts/templates/compareoils.ejs"],el:".content",events:{"click #compare-oils-share":"handleShare","click #price-button":"showPrices","change #toggle-petcoke":"handleParametersChange","change .slider":"handleParametersChange","change .config-dropdown":"handleDropdown","click .mp-summary":"handleParametersToggle"},initialize:function(){a=this,e=!0,f="ghgTotal",g="perBarrel",this.tip=d3.tip().attr("class","d3-tip").html(function(a){var b=o.map(function(b){var c=_.find(b,function(b){return b.y===a.y});return{name:utils.capitalize(c.step),value:c.x.toFixed(c.x<1?2:0),units:""}});return b.unshift({name:"Total",value:utils.numberWithCommas(a.ghgTotal,g),units:utils.getUnits("ghgTotal",g)}),utils.createTooltipHtml(a.y,a.type,b,utils.makeId(a.y))}).offset([0,0]),this.render(),$(window).on("resize",a.handleResize),$("#sort-select").change(this.handleSortSelect),$("#step-select").change(this.handleStepSelect),$("#ratio-select").change(this.handleRatioSelect),$(window).on("load",a.checkDataControlsPosition),$(window).on("scroll",a.checkDataControlsPosition)},parseURLAndSetState:function(){var b=utils.parseParametersFromShareURL(window.location.href);window.history.pushState("","",window.location.hash.split("?")[0]),b.sortRatio&&(g=b.sortRatio,utils.setInputFieldOption("ratio-select",g)),b.sortStep&&(f=b.sortStep,utils.setInputFieldOption("step-select",f)),b.sortOrderDescending&&(e="true"===b.sortOrderDescending?!0:!1,utils.setInputFieldOption("sort-select",b.sortOrderDescending)),(b.opgee||b.prelim||b.showCoke)&&a.modelParametersView.setModelParameters(b)},linkShareButton:function(){var b=new ZeroClipboard($("#compare-oils-share"));b.on("ready",function(){b.on("copy",function(b){var c=b.clipboardData,d=a.modelParametersView.getModelValues(),h=utils.buildShareURLFromParameters({sortOrderDescending:e,sortStep:f,sortRatio:g,opgee:utils.getOPGEEModel(d.water,d.steam,d.flaring),prelim:utils.getPRELIMModel(d.refinery),showCoke:d.showCoke});c.setData("text/plain",h)}),b.on("aftercopy",function(){alert("The shareable URL has been copied to your clipboard.")})})},render:function(){this.$el.html(this.template()),this.modelParametersView=new Oci.Views.ModelParameters,this.$("#model-parameters").html(this.modelParametersView.render()),this.parseURLAndSetState(),this.chartInit(),this.linkShareButton(),utils.initDropdown(),this.checkDataControlsPosition()},checkDataControlsPosition:function(){var a=$("#compare-oils-view .data-controls");if(a.length){var b=$(".panel-aside").offset(),c=$("#co-chart-cont"),d=c.outerHeight(),e=d+c.offset().top,f=e-$(window).scrollTop();f=f>d?d:f,$(window).scrollTop()>=b.top?a.addClass("sticky").width($(".panel-aside").outerWidth()).outerHeight(f):a.removeClass("sticky").width("").outerHeight("")}},createChartData:function(){o=[];for(var b=this.modelParametersView.getModelValues(),c={info:n.info,opgee:n.opgee[utils.getOPGEEModel(b.water,b.steam,b.flaring)],prelim:n.prelim[utils.getPRELIMModel(b.refinery)]},d=Object.keys(c.info),h=0;h<d.length;h++){var i=c.info[d[h]],j=c.opgee[d[h]],k=c.prelim[d[h]],l=+j["Net lifecycle emissions"],m=utils.getRefiningTotal(k),p=+i[utils.getDatasetKey("transport")],q=utils.getCombustionTotal(k,b.showCoke);l=+utils.getValueForRatio(l,g,k,b.showCoke,i),m=+utils.getValueForRatio(m,g,k,b.showCoke,i),p=+utils.getValueForRatio(p,g,k,b.showCoke,i),q=+utils.getValueForRatio(q,g,k,b.showCoke,i);var r=d3.sum([l,m,p,q]),s={id:utils.makeId(i.Unique),name:utils.prettyOilName(i),apiGravity:+i[utils.getDatasetKey("apiGravity")],oilDepth:+i[utils.getDatasetKey("oilDepth")],ghgTotal:r,upstream:l,midstream:m,downstream:q+p,waterToOilRatio:+j[utils.getDatasetKey("waterToOilRatio")],gasToOilRatio:+j[utils.getDatasetKey("gasToOilRatio")],type:i["Overall Crude Emissions Category"].trim()};o.push(s)}a.sortByField(o,f,e),o=w.map(function(a){return o.map(function(b){return{x:b.name,y:b[a],type:b.type,ghgTotal:b.ghgTotal}})});var t=d3.layout.stack();t(o),o=o.map(function(a){return a.map(function(a){return{x:a.y,y:a.x,x0:a.y0,type:a.type,ghgTotal:a.ghgTotal}})})},sortByField:function(a,b,c){p=_.groupBy(a,"type"),q=[],_.each(p,function(a,b){var c={};c.name=b,c.avgGhgTotal=_.pluck(a,"ghgTotal").reduce(function(a,b){return a+b})/a.length,q.push(c)}),q.sort(function(a,b){return a.avgGhgTotal-b.avgGhgTotal}),r=q.map(function(a){return a.name}),a.sort(function(a,d){return"type"===b?(1e6*r.indexOf(a.type)+a.ghgTotal-(1e6*r.indexOf(d.type)+d.ghgTotal))*(1-2*Number(c)):(a[b]-d[b])*(1-2*Number(c))})},chartInit:function(){var e=function(){var a=utils.getGlobalExtent(g,"max");h=d3.scale.linear().domain([0,a]).range([0,c]).nice();var b=o[0].map(function(a){return a.y});i=d3.scale.ordinal().domain(b).rangeRoundBands([0,d],.05),j=d3.scale.ordinal().domain(["upstream","midstream","downstream"]).rangePoints([1,.4])},f=function(){var b=m.selectAll("g").data(o).enter().append("g").classed("step",!0).attr("class",function(a,b){return"step "+w[b]});b.selectAll("rect").data(function(a,b){return a.map(function(a){a.step=w[b]}),a},function(a){return a.y}).enter().append("rect").attr("x",function(a){return h(a.x0)}).attr("y",function(a){return i(a.y)}).attr("height",function(){return i.rangeBand()}).attr("width",function(a){return h(a.x)}).attr("fill",function(a){return utils.categoryColorForType(a.type)}).attr("opacity",function(a){return j(a.step)}).on("mouseover",function(b){a.tip.show(b),$(".swatch").css("background",utils.categoryColorForType(b.type)),$('.stats-list dt:contains("'+utils.capitalize(b.step)+'")').css("color","orange"),$('.stats-list dt:contains("'+utils.capitalize(b.step)+'")').next().css("color","orange"),$('.stats-list dt:contains("Total")').addClass("total"),$('.stats-list dt:contains("Total")').next().addClass("total")}).on("mouseleave",function(){utils.insideTooltip(d3.event.clientX,d3.event.clientY)?$(".d3-tip").on("mouseleave",function(){a.tip.hide()}):a.tip.hide()})},p=function(){l=d3.svg.axis().scale(h).orient("top"),k=d3.svg.axis().scale(i).orient("right"),m.append("g").attr("class","y axis").call(k),m.selectAll(".y.axis text").attr("pointer-events","none"),m.append("g").attr("class","x axis").call(l);var b=m.append("g");b.append("text").attr("transform","translate("+c/2+",-60)").style("text-anchor","middle").attr("class","x axis title").text(a.getXAxisTitle()),b.append("text").attr("transform","translate("+c/2+",-40)").style("text-anchor","middle").attr("class","x axis title subtitle").text(utils.getUnits("ghgTotal",g))};b=$(s),c=b.width()-u.left-u.right,m=d3.select(s).append("svg").attr("width",c+u.left+u.right).append("g").attr("transform","translate("+u.left+","+u.top+")"),m.call(a.tip),n=utils.cloneObject(Oci.data);var q=Object.keys(Oci.data.info).length;d=v*q,d3.select(s+" svg").attr("height",d+u.top+u.bottom),a.createChartData(),e(),f(),p()},handleSortSelect:function(){e=!e,a.createChartData(),a.updateChart(!1,!1)},handleStepSelect:function(){for(var b,c=document.getElementsByName("step-select"),d=0;d<c.length;d++)if(c[d].checked){b=c[d].value,f=b;break}a.createChartData(),a.updateChart(!1,!1)},handleRatioSelect:function(){for(var b,c=document.getElementsByName("ratio-select"),d=0;d<c.length;d++)if(c[d].checked){b=c[d].value,g=b;break}a.createChartData(),a.updateChart(!0,!0)},updateChart:function(b,c){a.updateScales(b),a.updateAxes(c),a.updateData()},updateData:function(){var a=m.selectAll(".step").data(o);a.selectAll("rect").data(function(a,b){return a.map(function(a){a.step=w[b]}),a},function(a){return a.y}).transition().duration(t).attr("x",function(a){return h(a.x0)}).attr("y",function(a){return i(a.y)}).attr("height",function(){return i.rangeBand()}).attr("width",function(a){return h(a.x)})},updateScales:function(a){if(a!==!1){var b=utils.getGlobalExtent(g,"max");h.domain([0,b]).nice()}var c=o[0].map(function(a){return a.y});i.domain(c)},updateAxes:function(b){m.select(".y.axis").transition().duration(t).call(k),m.select(".x.axis").transition().duration(t).call(l),b&&$(".x.axis.title").fadeOut(t/2,function(){m.select(".x.axis.subtitle").text(utils.getUnits(f,g)),m.select(".x.axis.title").text(a.getXAxisTitle()),$(this).fadeIn(t/2)})},handleShare:function(a){a.preventDefault()},showPrices:function(a){a.preventDefault(),Oci.showPricesModal(!0)},updatePrices:function(){a.createChartData(),a.updateChart(!0,!1)},handleResize:function(){c=b.width()-u.left-u.right,d3.select(s+" svg").remove(),a.chartInit()},getXAxisTitle:function(){return utils.getDatasetName(f,g)},handleDropdown:function(){$(".config-dropdown").blur(),a.handleParametersChange()},handleParametersChange:function(){a.createChartData(),a.updateChart(!1,!1)},handleParametersToggle:function(){$("#model-parameters").toggleClass("open")},shareOpen:function(){var b=a.modelParametersView.getModelValues(),c=utils.buildShareURLFromParameters({sortOrderDescending:e,sortStep:f,sortRatio:g,opgee:utils.getOPGEEModel(b.water,b.steam,b.flaring),prelim:utils.getPRELIMModel(b.refinery),showCoke:b.showCoke}),d=encodeURIComponent(utils.buildShareURLFromParameters({})),h=utils.generateSocialLinks(d);$("li.twitter a").attr("href",h.twitter),$("li.linkedin a").attr("href",h.linkedIn),$("li.email a").attr("href",h.mail),$("#share-copy").attr("value",c)}})}(),Oci.Views=Oci.Views||{},function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r="#emissions-drivers",s={top:38,right:18,bottom:72,left:84},t=1.5,u=1e3,v=.1;Oci.Views.EmissionsDrivers=Backbone.View.extend({template:JST["app/scripts/templates/emissionsdrivers.ejs"],el:".content",events:{"click #x-select":"changeXProperty","click #y-select":"changeYProperty","click #ratio-select":"handleRatioSelect","click #emissions-drivers-share":"handleShare",click:"hideTip","click #price-button":"showPrices","change #toggle-petcoke":"handleParametersChange","change .slider":"handleParametersChange","change .config-dropdown":"handleDropdown","click .mp-summary":"handleParametersToggle"},hideTip:function(){a.tip.hide()},initialize:function(){a=this,$(window).on("resize",a.handleResize),a.tip=d3.tip().attr("class","d3-tip").html(function(a){var b=[{name:utils.getDatasetName(o),value:utils.numberWithCommas(+a[o]),units:utils.getUnits(o,q)},{name:utils.getDatasetName(p).split(" ").pop(),value:utils.numberWithCommas(+a[p],q),units:utils.getUnits(p,q)},{name:utils.getDatasetName("productionVolume"),value:utils.numberWithCommas(a.productionVolume),units:utils.getUnits("productionVolume",q)}];return utils.createTooltipHtml(a.name,a.type,b,a.id)}).offset([0,0]),o="apiGravity",p="ghgTotal",q="perBarrel",a.render()},parseURLAndSetState:function(){var b=utils.parseParametersFromShareURL(window.location.href);window.history.pushState("","",window.location.hash.split("?")[0]),b.xProperty&&(o=b.xProperty,utils.setInputFieldOption("x-select",o)),b.yProperty&&(p=b.yProperty,utils.setInputFieldOption("y-select",p)),b.sortRatio&&(q=b.sortRatio,utils.setInputFieldOption("ratio-select",q)),(b.opgee||b.prelim||b.showCoke)&&a.modelParametersView.setModelParameters(b)},linkShareButton:function(){var b=new ZeroClipboard($("#emissions-drivers-share"));b.on("ready",function(){b.on("copy",function(b){var c=b.clipboardData,d=a.modelParametersView.getModelValues(),e=utils.buildShareURLFromParameters({xProperty:o,yProperty:p,opgee:utils.getOPGEEModel(d.water,d.steam,d.flaring),prelim:utils.getPRELIMModel(d.refinery),showCoke:d.showCoke});c.setData("text/plain",e)}),b.on("aftercopy",function(){alert("The shareable URL has been copied to your clipboard.")})})},render:function(){this.$el.html(this.template()),this.modelParametersView=new Oci.Views.ModelParameters,this.$("#model-parameters").html(this.modelParametersView.render()),this.parseURLAndSetState(),this.chartInit(),this.linkShareButton(),utils.initDropdown()},addExtentBuffer:function(a){return"object"==typeof a?(a[0]=a[0]*(1-v),a[1]=a[1]*(1+v)):a*=1+v,a},chartInit:function(){var u=function(){var b=a.addExtentBuffer(d3.max(k,function(a){return a[o]}));e=d3.scale.linear().domain([0,b]).range([0,c]);var h=utils.getGlobalExtent(q,"min",p),i=utils.getGlobalExtent(q,"max",p),j=a.addExtentBuffer([h,i]);f=d3.scale.linear().domain(j).range([d,0]);var l=a.addExtentBuffer(d3.extent(k,function(a){return a.productionVolume}));g=d3.scale.sqrt().domain(l).range([4,42]),a.rScale=g},v=function(){h=d3.svg.axis().scale(e).orient("bottom").ticks(5),i=d3.svg.axis().scale(f).orient("left").ticks(5),l.append("g").attr("class","x axis").attr("transform","translate(0,"+(d+4)+")").call(h);var a=l.append("g");a.append("text").attr("transform","translate("+c/2+","+(d+s.bottom-25)+")").style("text-anchor","middle").attr("class","x axis title").text(utils.getDatasetName(o)),a.append("text").attr("transform","translate("+c/2+","+(d+s.bottom-5)+")").style("text-anchor","middle").attr("class","x axis title subtitle").text(utils.getUnits(o)),l.append("g").attr("class","y axis").attr("transform","translate(-4,0)").call(i),a=l.append("g"),a.append("text").attr("transform","rotate(-90)").attr("y",-s.left).attr("x",-(d/2)).attr("dy","1em").style("text-anchor","middle").attr("class","y axis title").text(utils.getDatasetName(p,q,!0)),a.append("text").attr("transform","rotate(-90)").attr("y",-s.left+20).attr("x",-(d/2)).attr("dy","1em").style("text-anchor","middle").attr("class","y axis title subtitle").text(utils.getUnits(p,q))},w=function(){l.selectAll("circle").data(k).enter().append("circle").attr("fill",function(a){return utils.categoryColorForType(a.type)}).attr("opacity",.8).attr("cx",function(a){return e(a[o])}).attr("cy",function(a){return f(a[p])}).attr("r",function(a){return g(a.productionVolume)}).attr("clip-path","url(#chart-area)").on("mouseover",function(b){a.tip.show(b),$(".swatch").css("background",utils.categoryColorForType(b.type))}).on("mouseout",function(){utils.insideTooltip(d3.event.clientX,d3.event.clientY)?$(".d3-tip").on("mouseleave",function(){a.tip.hide()}):a.tip.hide()}),d3.select("svg").selectAll(".circle-legend").data([50,68,81]).enter().append("circle").classed("circle-legend",!0).attr("fill-opacity","0").attr("stroke","#777").attr("cx",function(){return c+s.left+s.right-40}).attr("cy",function(a){return a}).attr("r",function(a,b){return g([5e5,1e5,1e3][b])}),d3.select("svg").selectAll(".circle-text").data([{text:"500k",y:11},{text:"100k",y:48},{text:"10k",y:74}]).enter().append("text").classed("circle-text",!0).attr("x",function(){return c+s.left+s.right-40}).attr("y",function(a){return a.y}).attr("text-anchor","middle").style("fill","#777").text(function(a){return a.text}),d3.select("svg").append("text").attr("x",function(){return c+s.left+s.right-90}).attr("y",30).attr("text-anchor","end").classed("circle-text",!0).style("fill","#777").text("Production Volume"),d3.select("svg").append("text").attr("x",function(){return c+s.left+s.right-90}).attr("y",45).attr("text-anchor","end").classed("circle-text",!0).style("fill","#777").text("Barrels per Day")},x=function(){var a=k.map(function(a){return[e(a[o]),f(a[p])]});n=ss.linear_regression().data(a).line();var b=ss.r_squared(a,n);m=d3.svg.line().x(function(a){return a}).y(function(a){return n(a)}),l.append("path").attr("clip-path","url(#chart-area)").attr("d",m(e.range())).attr("class","trend").attr("opacity",Math.min(b+.2,1))};b=$(r),c=b.width()-s.left-s.right,d=Math.round(c/t),l=d3.select(r).append("svg").attr("width",c+s.left+s.right).attr("height",d+s.top+s.bottom).append("g").attr("transform","translate("+s.left+","+s.top+")"),l.call(a.tip),l.append("clipPath").attr("id","chart-area").append("rect").attr("width",c).attr("height",d),j=utils.cloneObject(Oci.data),a.createChartData(),u(),v(),x(),w()},createChartData:function(){k=[];for(var a=this.modelParametersView.getModelValues(),b={info:j.info,opgee:j.opgee[utils.getOPGEEModel(a.water,a.steam,a.flaring)],prelim:j.prelim[utils.getPRELIMModel(a.refinery)]},c=Object.keys(b.info),d=0;d<c.length;d++){var e=b.info[c[d]],f=b.opgee[c[d]],g=b.prelim[c[d]],h=+f["Net lifecycle emissions"],i=utils.getRefiningTotal(g),l=+e[utils.getDatasetKey("transport")],m=utils.getCombustionTotal(g,a.showCoke);h=+utils.getValueForRatio(h,q,g,a.showCoke,e),i=+utils.getValueForRatio(i,q,g,a.showCoke,e),l=+utils.getValueForRatio(l,q,g,a.showCoke,e),m=+utils.getValueForRatio(m,q,g,a.showCoke,e);var n=d3.sum([h,i,l,m]),o={id:utils.makeId(e.Unique),name:utils.prettyOilName(e),apiGravity:+e[utils.getDatasetKey("apiGravity")],oilDepth:+e[utils.getDatasetKey("oilDepth")],ghgTotal:n,productionVolume:+e[utils.getDatasetKey("productionVolume")],upstream:h,midstream:i,downstream:m+l,waterToOilRatio:+f[utils.getDatasetKey("waterToOilRatio")],gasToOilRatio:+f[utils.getDatasetKey("gasToOilRatio")],prodGasoline:+g[utils.getDatasetKey("prodGasoline")],prodDiesel:+g[utils.getDatasetKey("prodDiesel")],prodBunker:+g[utils.getDatasetKey("prodBunker")],sulfurContent:100*+e[utils.getDatasetKey("sulfurContent")],yearsProduction:+e[utils.getDatasetKey("yearsProduction")],type:e["Overall Crude Emissions Category"].trim()};k.push(o)}k.sort(function(a,b){return b.productionVolume-a.productionVolume})},changeXProperty:function(){for(var b=document.getElementsByName("x-select"),c=0;c<b.length;c++)if(b[c].checked){o=b[c].value;break}a.updateChart("x")},changeYProperty:function(){for(var b=document.getElementsByName("y-select"),c=0;c<b.length;c++)if(b[c].checked){p=b[c].value;break}a.updateChart("y")},handleRatioSelect:function(){for(var b,c=document.getElementsByName("ratio-select"),d=0;d<c.length;d++)if(c[d].checked){b=c[d].value,q=b;break}a.createChartData(),a.updateChart("y")},updateScales:function(){var b=a.addExtentBuffer(d3.max(k,function(a){return a[o]}));e.domain([0,b]);var c=utils.getGlobalExtent(q,"min",p),d=utils.getGlobalExtent(q,"max",p),g=a.addExtentBuffer([c,d]);f.domain(g)},updateAxes:function(a){a&&"x"!==a||(l.select(".x.axis").transition().duration(u).call(h),$(".x.axis.title").fadeOut(u/2,function(){l.select(".x.axis.subtitle").text(utils.getUnits(o,q)),l.select(".x.axis.title").text(utils.getDatasetName(o)),$(this).fadeIn(u/2)})),a&&"y"!==a||(l.select(".y.axis").transition().duration(u).call(i),$(".y.axis.title").fadeOut(u/2,function(){l.select(".y.axis.subtitle").text(utils.getUnits(p,q)),l.select(".y.axis.title").text(utils.getDatasetName(p,q,!0)),$(this).fadeIn(u/2)}))},updateData:function(){l.selectAll("circle").data(k).transition().duration(u).attr("cx",function(a){return e(a[o])}).attr("cy",function(a){return f(a[p])})},updateLine:function(){var a=k.map(function(a){return[e(a[o]),f(a[p])]});n=ss.linear_regression().data(a).line();var b=ss.r_squared(a,n);l.select(".trend").transition().duration(u).attr("d",m(e.range())).attr("opacity",Math.min(b+.2,1))},updateChart:function(b){a.updateScales(),a.updateAxes(b),a.updateLine(),a.updateData()},handleShare:function(a){a.preventDefault()},handleResize:function(){c=b.width()-s.left-s.right,d=Math.round(c/t),d3.select(r+" svg").remove(),a.chartInit()},showPrices:function(a){a.preventDefault(),Oci.showPricesModal(!0)},updatePrices:function(){a.createChartData(),a.updateChart("y")},handleDropdown:function(){$(".config-dropdown").blur(),a.handleParametersChange()},handleParametersChange:function(){a.createChartData(),a.updateChart()},handleParametersToggle:function(){$("#model-parameters").toggleClass("open")},shareOpen:function(){var b=a.modelParametersView.getModelValues(),c=utils.buildShareURLFromParameters({xProperty:o,yProperty:p,opgee:utils.getOPGEEModel(b.water,b.steam,b.flaring),prelim:utils.getPRELIMModel(b.refinery),showCoke:b.showCoke}),d=encodeURIComponent(utils.buildShareURLFromParameters({})),e=utils.generateSocialLinks(d);$("li.twitter a").attr("href",e.twitter),$("li.linkedin a").attr("href",e.linkedIn),$("li.email a").attr("href",e.mail),$("#share-copy").attr("value",c)}})}(),Oci.Views=Oci.Views||{},function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m={top:0,right:10,bottom:0,left:0},n=60-m.top-m.bottom,o=2,p="#ccc";Oci.Views.OilDetails=Backbone.View.extend({template:JST["app/scripts/templates/oildetails.ejs"],el:".content",events:{"change #toggle-petcoke":"handleParametersChange","change .slider":"handleParametersChange","change .config-dropdown":"handleDropdown","click #oil-details-share":"handleShare"},initialize:function(b){a=this;for(var c in Oci.data.info)if(utils.makeId(c)===b.oil){l=c;break}l||console.warn("Unable to find key for oil id"),a.tip=d3.tip().attr("class","d3-tip").html(function(b,c){for(var d=utils.getUnits("ghgTotal","perBarrel"),e="",f=b.components[a.getStepName(c)],g=0;g<f.length;g++){e+='<dt style="width:80%;">'+f[g].name+"</dt>";var h=Number(f[g].value);h=h.toFixed(Math.abs(h)<1?1:0),e+='<dd style="width:20%;">'+h+"</dd>"}return'<div class="popover in"><div class="popover-inner"><div class="popover-header"><dl class="stats-list"><dt>'+a.getStepName(c)+' emissions<small class="units">'+d+"</small></dt><dd>"+a.dataForSvg(c,b).toFixed(0)+'</dd></dl></div><div class="popover-body"><dl class="stats-list">'+e+"</dl></div></div></div>"}).offset(function(b,c){return a.dataForSvg(c,b)<.3*f.domain()[1]?[0,25]:[-10,0]}).direction(function(b,c){return a.dataForSvg(c,b)<.3*f.domain()[1]?"e":"n"}),a.oil=a.generateOilInfo(),this.render(),$(window).on("resize",a.handleResize)},render:function(){this.$el.html(this.template({oil:this.oil,totalUnits:utils.getUnits("ghgTotal","perBarrel")})),this.$('[data-toggle="tooltip"]').tooltip(),this.modelParametersView=new Oci.Views.ModelParameters,this.$("#model-parameters").html(this.modelParametersView.render()),$("#dropdown-refinery").prop("selectedIndex",utils.refineryNameToDropdown(Oci.data.info[l]["Default Refinery"])),$('#dropdown-refinery option[value="0 = Default"]').hide(),d=n*(1/3)-o,e=n-d,$("#oil-details-description").html(Oci.blurbs[l].description),L.mapbox.accessToken="pk.eyJ1IjoiZGV2c2VlZCIsImEiOiJnUi1mbkVvIn0.018aLhX0Mb0tdtaT2QNe2Q";var a=L.mapbox.map("map","mapbox.light",{center:[20,0],zoom:3,zoomControl:!1,keyboard:!1,tap:!1,dragging:!1,touchZoom:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1});
_.each(Oci.data.info,function(b){var c=L.divIcon({html:'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" width="24" height="24" id="svg4460"> <defs id="defs4462" /> <metadata id="metadata4465"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title /> </cc:Work> </rdf:RDF> </metadata> <g transform="translate(0,-1028.3622)" id="layer1"> <g transform="translate(-476,-237.99998)" id="oil-well-24" style="display:inline"> <g transform="translate(2,0)" id="g7345"> <path d="m 484.5,1269.3622 c -0.5,0 -0.84615,0.5 -1,1 l -5.34375,15.9688 c -0.038,0.1133 -0.15625,0.4166 -0.15625,0.5312 0,0.5 0.5,0.5 1,0.5 0.5,0 0.97049,0 1.15625,-0.5 l 0.84375,-2.25 5.5,-2.75 5.5,2.75 0.84375,2.25 c 0.18576,0.5 0.65625,0.5 1.15625,0.5 0.5,0 1,0 1,-0.5 0,-0.1146 -0.11823,-0.418 -0.15625,-0.5312 L 489.5,1270.3622 c -0.15385,-0.5 -0.5,-1 -1,-1 z m 4.5,7 0.6875,1.9063 -3.1875,1.5937 -3.1875,-1.5937 0.6875,-1.9063 z m -6.3125,3.5938 1.8125,0.9062 -2.625,1.3125 z m 7.625,0 0.8125,2.2187 -2.625,-1.3125 z" inkscape:connector-curvature="0" id="path5656" style="opacity:0.3;color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:#ffffff;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" /> <path d="m 484.5,1269.3622 c -0.5,0 -0.84615,0.5 -1,1 l -5.34375,15.9688 c -0.038,0.1133 -0.15625,0.4166 -0.15625,0.5312 0,0.5 0.5,0.5 1,0.5 0.5,0 0.97049,0 1.15625,-0.5 l 0.84375,-2.25 5.5,-2.75 5.5,2.75 0.84375,2.25 c 0.18576,0.5 0.65625,0.5 1.15625,0.5 0.5,0 1,0 1,-0.5 0,-0.1146 -0.11823,-0.418 -0.15625,-0.5312 L 489.5,1270.3622 c -0.15385,-0.5 -0.5,-1 -1,-1 z m 4.5,7 0.6875,1.9063 -3.1875,1.5937 -3.1875,-1.5937 0.6875,-1.9063 z m -6.3125,3.5938 1.8125,0.9062 -2.625,1.3125 z m 7.625,0 0.8125,2.2187 -2.625,-1.3125 z" inkscape:connector-curvature="0" id="path6960-9" style="color:#000000;fill:#444444;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:2;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" /> </g> </g> </g> <rect width="24" height="24" x="0" y="0" id="canvas" style="fill:none;stroke:none;visibility:hidden" /> </svg>',iconSize:[24,24],iconAnchor:[12,12],className:l===b.Unique?"active":"non-active"});L.marker([b.Latitude,b.Longitude],{icon:c,clickable:!1}).addTo(a)});var b=Oci.data.info[l];a.setView([b.Latitude,b.Longitude],4),this.parseURLAndSetState(),this.chartInit(),this.linkShareButton(),utils.initDropdown()},getStepName:function(a){return a[0][0].parentNode.parentNode.id.split("-")[0]},generateOilInfo:function(){var a=Oci.data.info[l];a||console.warn("Unable to find oil for id:",l);var b=function(a,b){return"API Gravity: "+parseInt(a)+" | Sulfur Percentage: "+parseFloat(b).toFixed(2)+"%"},c=function(a){return parseInt(a)+" feet | "+parseInt(.3048*a)+" meters"},d={name:utils.prettyOilName(a),keyStats:[{key:"Oil-Climate Category",value:a["Overall Crude Emissions Category"]},{key:"Location",value:a["Onshore/Offshore"]},{key:"Sulfur Content",value:a["Sulfur Category"],title:b(a.API,a["Sulfur %wt"])},{key:"Depth",value:a["Shallow; Deep; Ultra-Deep"],title:c(a["Field Depth"])},{key:"Production Volume",value:a["Production Volume"]},{key:"Flare Rate",value:a["Flaring Class"]},{key:"Water Content",value:a["Watery Oil"]},{key:"Gas Content",value:a["Gassy Oil"]},{key:"Default Refinery Configuration",value:a["Default Refinery"]}]};return d},parseURLAndSetState:function(){var b=utils.parseParametersFromShareURL(window.location.href);window.history.pushState("","",window.location.hash.split("?")[0]),(b.opgee||b.prelim||b.showCoke)&&a.modelParametersView.setModelParameters(b)},linkShareButton:function(){var b=new ZeroClipboard($("#oil-details-share"));b.on("ready",function(){b.on("copy",function(b){var c=b.clipboardData,d=a.modelParametersView.getModelValues(),e=utils.buildShareURLFromParameters({opgee:utils.getOPGEEModel(d.water,d.steam,d.flaring),prelim:utils.getPRELIMModel(d.refinery),showCoke:d.showCoke});c.setData("text/plain",e)}),b.on("aftercopy",function(){alert("The shareable URL has been copied to your clipboard.")})})},updateSvg:function(b){b.selectAll("rect").data(k).transition().duration(1e3).attr("width",function(c){return f(a.dataForSvg(b,c))});var c=0,d=k[1].components[a.getStepName(b)];b.selectAll(".component").data(d).transition().duration(1e3).attr("x",function(a){return c+=+a.value,f(c)})},createChartData:function(){var a=function(a,b,c){var d=a.info[l],e=a.opgee[l],f=a.prelim[l],g=+e["Net lifecycle emissions"],h=+utils.getRefiningTotal(f),i=+d[utils.getDatasetKey("transport")],j=+utils.getCombustionTotal(f,b),k=d3.sum([g,h,i,j]),m={isDefault:c,id:utils.makeId(d.Unique),name:utils.prettyOilName(d),apiGravity:+d[utils.getDatasetKey("apiGravity")],oilDepth:+d[utils.getDatasetKey("oilDepth")],ghgTotal:k,upstream:g,midstream:h,downstream:j+i,waterToOilRatio:+e[utils.getDatasetKey("waterToOilRatio")],gasToOilRatio:+e[utils.getDatasetKey("gasToOilRatio")],type:d["Overall Crude Emissions Category"].trim(),components:{downstream:utils.getDownstreamComponents(f,b,i),midstream:utils.getRefiningComponents(f),upstream:utils.getExtractionComponents(e)}};return m},b={info:j.info,opgee:j.opgee[utils.getOPGEEModel("1","1","1")],prelim:j.prelim[utils.getPRELIMModel("0 = Default")]},c=this.modelParametersView.getModelValues(),d={info:j.info,opgee:j.opgee[utils.getOPGEEModel(c.water,c.steam,c.flaring)],prelim:j.prelim[utils.getPRELIMModel(c.refinery)]};k=[a(b,!0,!0),a(d,c.showCoke,!1)]},dataForSvg:function(a,b){return a===g?b.upstream:a===i?b.downstream:a===h?b.midstream:void console.warn("oops!")},handleParametersChange:function(){a.createChartData(),$("#model-total").html(k[1].ghgTotal.toFixed(0)),a.updateSvg(g),a.updateSvg(i),a.updateSvg(h)},chartInit:function(){var q=function(){f=d3.scale.linear().domain([0,d3.max(k,function(){return d3.max([utils.getGlobalExtent("perBarrel","max","downstream",l),utils.getGlobalExtent("perBarrel","max","midstream",l),utils.getGlobalExtent("perBarrel","max","upstream",l)])})]).range([0,c])},r=function(b){$("#model-total").html(k[1].ghgTotal.toFixed(0)),$("#default-total").html("("+k[0].ghgTotal.toFixed(0)+")"),$("#od-chart-cont .data-charts .value").css("color",utils.categoryColorForType(k[1].type)),$("#oil-name").html(a.oil.name),b.selectAll("rect").data(k).enter().append("rect").attr("x",function(){return f(0)}).attr("y",function(a){return a.isDefault?e+o:0}).attr("width",function(c){return f(a.dataForSvg(b,c))}).attr("height",function(a){return a.isDefault?d:e}).attr("rx",2).attr("ry",2).attr("fill",function(a){return a.isDefault?p:utils.categoryColorForType(a.type)}).attr("opacity",function(a){return a.isDefault?.6:.8}).on("mouseover",function(c){c.isDefault||a.tip.show(c,b)}).on("mouseout",function(b){b.isDefault||(utils.insideTooltip(d3.event.clientX,d3.event.clientY)?$(".d3-tip").on("mouseleave",function(){a.tip.hide()}):a.tip.hide())});var c=0,g=k[1].components[a.getStepName(b)],h=_.every(g,function(a){return+a.value>=0});h&&b.selectAll(".component").data(g).enter().append("rect").attr("class","component").attr("pointer-events","none").attr("x",function(a){return c+=+a.value,f(c)}).attr("y",0).attr("width",f(.25)).attr("height",e).attr("rx",2).attr("ry",2).attr("fill","#fff")};b=$(".panel-body"),c=b.width()-m.left-m.right,g=d3.select("#upstream-bar").append("svg").attr("width",c+m.left+m.right).attr("height",n+m.top+m.bottom).append("g").attr("transform","translate("+m.left+","+m.top+")"),i=d3.select("#downstream-bar").append("svg").attr("width",c+m.left+m.right).attr("height",n+m.top+m.bottom).append("g").attr("transform","translate("+m.left+","+m.top+")"),h=d3.select("#midstream-bar").append("svg").attr("width",c+m.left+m.right).attr("height",n+m.top+m.bottom).append("g").attr("transform","translate("+m.left+","+m.top+")"),g.call(a.tip),h.call(a.tip),i.call(a.tip),j=utils.cloneObject(Oci.data),a.createChartData(),q(),r(g),r(h),r(i)},handleDropdown:function(){$(".config-dropdown").blur(),a.handleParametersChange()},handleResize:function(){c=b.width()-m.left-m.right,d3.select("#upstream-bar").html(""),d3.select("#midstream-bar").html(""),d3.select("#downstream-bar").html(""),a.chartInit()},handleShare:function(a){a.preventDefault()},shareOpen:function(){var b=a.modelParametersView.getModelValues(),c=utils.buildShareURLFromParameters({opgee:utils.getOPGEEModel(b.water,b.steam,b.flaring),prelim:utils.getPRELIMModel(b.refinery),showCoke:b.showCoke}),d=encodeURIComponent(utils.buildShareURLFromParameters({})),e=utils.generateSocialLinks(d);$("li.twitter a").attr("href",e.twitter),$("li.linkedin a").attr("href",e.linkedIn),$("li.email a").attr("href",e.mail),$("#share-copy").attr("value",c)}})}(),Oci.Views=Oci.Views||{},function(){"use strict";var a;Oci.Views.Prices=Backbone.View.extend({template:JST["app/scripts/templates/prices.ejs"],el:"#modal-prices",events:{"click .apply":"handleApply","click [data-modal-dismiss]":"handleDismissClick","keyup .price-input":"verifyPrice","click .reset":"handleReset"},initialize:function(){a=this,this.render(),this.loadPrices()},render:function(){this.$el.html(this.template())},loadPrices:function(){for(var a in Oci.prices){var b='input[name="'+a+'"]';$(b).val(parseFloat(Oci.prices[a].price).toFixed(2))}},handleDismissClick:function(b){b.preventDefault(),Oci.showPricesModal(!1),a.loadPrices()},handleApply:function(a){a.preventDefault(),Oci.showPricesModal(!1);for(var b in Oci.prices){var c='input[name="'+b+'"]',d=$(c),e=parseFloat(d.val()).toFixed(2);d.val(e),Oci.prices[b].price=e}Oci.view.updatePrices&&Oci.view.updatePrices()},verifyPrice:function(a){var b=a.target,c=/^\d{0,5}(\.\d{0,2})?$/.test(b.value);if(!c){var d=b.value;d=d.replace(/[^\d.]/g,""),d=parseFloat(d).toFixed(2),(isNaN(d)||d.length>=9)&&(d=parseFloat(2).toFixed(2)),b.value=d}},handleReset:function(b){b.preventDefault(),Oci.prices=utils.cloneObject(Oci.origPrices),a.loadPrices()}})}(),Oci.Views=Oci.Views||{},function(){"use strict";var a,b,c,d,e,f,g;Oci.Views.ModelParameters=Backbone.View.extend({template:JST["app/scripts/templates/modelparameters.ejs"],el:"#model-parameters",events:{"click .toggle":"toggleModelParameters","change input":"updateSummary","change .slider":"updateSummary","change select":"updateSummary"},initialize:function(){a=this,this.setSliders()},render:function(){this.$el.html(this.template()),this.addSliders(),this.updateSummary(),this.$('[data-toggle="tooltip"]').tooltip()},getModelValues:function(){return{water:$("#slider-water").val()/100,steam:$("#slider-steam").val()/100,flaring:$("#slider-flaring").val()/100,refinery:$("#dropdown-refinery").val(),showCoke:$("#toggle-petcoke").is(":checked")}},setModelParameters:function(b){if(b.opgee)try{var c=b.opgee[3],d=b.opgee[4],e=b.opgee[5],f=100*parseFloat(Oci.data.metadata.water.split(",")[c]);$("#slider-water").val(f),f=100*parseFloat(Oci.data.metadata.steam.split(",")[d]),$("#slider-steam").val(f),f=100*parseFloat(Oci.data.metadata.flare.split(",")[e]),$("#slider-flaring").val(f)}catch(g){console.warn("bad input parameter")}if(b.prelim)try{var h=b.prelim[3];$("#dropdown-refinery").prop("selectedIndex",h)}catch(g){console.warn("bad input parameter",g)}void 0!==b.showCoke&&("false"===b.showCoke?$("#toggle-petcoke").attr("checked",!1):"true"===b.showCoke&&$("#toggle-petcoke").attr("checked",!0)),a.updateSummary()},updateSummary:function(){var a=parseInt($("#slider-flaring").val());$(".value.flare span").html(a+"%");var b=parseInt($("#slider-water").val());$(".value.water span").html(b+"%");var c=parseInt($("#slider-steam").val());$(".value.steam span").html(c+"%");var d=$("#toggle-petcoke").is(":checked")?"On":"Off";$(".value.petcoke span").html(d);var e=$("#dropdown-refinery").val();switch(e){case"0 = Default":e="Default";break;case"1 = Hydroskimming":e="Hydro";break;case"2 = Medium Conversion":e="Medium";break;case"3 = Deep Conversion (Coking)":e="Deep Coke";break;case"4 = Deep Conversion (Hydrotreating)":e="Deep Hydro"}$(".value.refinery span").html(e)},addSliders:function(){$("#slider-flaring").noUiSlider({start:100,connect:"lower",snap:!0,range:_.object(c,b)}),$("#slider-flaring").noUiSlider_pips({mode:"values",values:b,density:10,format:wNumb({postfix:"%"}),stepped:!0}),$("#slider-steam").noUiSlider({start:100,connect:"lower",snap:!0,range:_.object(e,d)}),$("#slider-steam").noUiSlider_pips({mode:"values",values:d,density:10,format:wNumb({postfix:"%"}),stepped:!0}),$("#slider-water").noUiSlider({start:100,connect:"lower",snap:!0,range:_.object(g,f)}),$("#slider-water").noUiSlider_pips({mode:"values",values:f,density:10,format:wNumb({postfix:"%"}),stepped:!0})},toggleModelParameters:function(a){a.preventDefault(),$("#model-parameters").toggleClass("open")},setSliders:function(){var a=Oci.data.metadata;b=a.flare.split(",").map(function(a){return 100*Number(a)}),d=a.steam.split(",").map(function(a){return 100*Number(a)}),f=a.water.split(",").map(function(a){return 100*Number(a)}),c=this.sliderHelper(b),e=this.sliderHelper(d),g=this.sliderHelper(f)},sliderHelper:function(a){var b=d3.min(a),c=d3.max(a),d=a.map(function(a){return((a-b)/((c-b)/100)).toFixed(0)+"%"});return d[0]="min",d[d.length-1]="max",d}})}(),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;(e||!/destroy|hide/.test(b))&&(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.init("tooltip",a,b)};c.VERSION="3.3.4",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport),this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c&&c.$tip&&c.$tip.is(":visible")?void(c.hoverState="in"):(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.options.container?a(this.options.container):this.$element.parent(),p=this.getPosition(o);h="bottom"==h&&k.bottom+m>p.bottom?"top":"top"==h&&k.top-m<p.top?"bottom":"right"==h&&k.right+l>p.width?"left":"left"==h&&k.left-l<p.left?"right":h,f.removeClass(n).addClass(h)}var q=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(q,h);var r=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",r).emulateTransitionEnd(c.TRANSITION_DURATION):r()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top=b.top+g,b.left=b.left+h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);return this.$element.trigger(g),g.isDefaultPrevented()?void 0:(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=d?{top:0,left:0}:b.offset(),g={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},h=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,g,h,f)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.width&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type)})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery);
